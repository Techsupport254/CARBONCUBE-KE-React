<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<!-- Dynamic meta tags will be populated by server-side rendering -->
		<title id="page-title">Loading Shop...</title>
		<meta
			name="description"
			id="page-description"
			content="Loading shop information..."
		/>
		<meta
			name="keywords"
			id="page-keywords"
			content="Carbon Cube Kenya, online marketplace"
		/>

		<!-- Open Graph Tags -->
		<meta property="og:type" content="website" />
		<meta property="og:url" id="og-url" content="" />
		<meta property="og:title" id="og-title" content="" />
		<meta property="og:description" id="og-description" content="" />
		<meta property="og:image" id="og-image" content="" />
		<meta property="og:site_name" content="Carbon Cube Kenya" />
		<meta property="og:locale" content="en_US" />
		<meta property="og:image:width" content="1200" />
		<meta property="og:image:height" content="630" />
		<meta property="og:image:type" content="image/png" />

		<!-- Twitter Card Tags -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@carboncube_kenya" />
		<meta name="twitter:creator" content="@carboncube_kenya" />
		<meta name="twitter:title" id="twitter-title" content="" />
		<meta name="twitter:description" id="twitter-description" content="" />
		<meta name="twitter:image" id="twitter-image" content="" />

		<!-- Canonical URL -->
		<link rel="canonical" id="canonical-url" href="" />

		<!-- Structured Data -->
		<script type="application/ld+json" id="structured-data">
			{
				"@context": "https://schema.org",
				"@type": "LocalBusiness",
				"name": "Loading...",
				"description": "Loading shop information..."
			}
		</script>

		<!-- Redirect to actual shop page -->
		<script>
			// Extract shop slug from URL
			const pathParts = window.location.pathname.split("/");
			const shopSlug = pathParts[pathParts.length - 1];

			if (shopSlug && shopSlug !== "shop-preview.html") {
				// Fetch meta tags from API and populate the page
				fetch(`/api/shop/${shopSlug}/meta`)
					.then((response) => response.json())
					.then((data) => {
						// Update meta tags
						document.getElementById("page-title").textContent = data.title;
						document
							.getElementById("page-description")
							.setAttribute("content", data.description);
						document
							.getElementById("page-keywords")
							.setAttribute("content", data.keywords);

						// Update Open Graph tags
						document
							.getElementById("og-url")
							.setAttribute("content", data.og_url);
						document
							.getElementById("og-title")
							.setAttribute("content", data.og_title);
						document
							.getElementById("og-description")
							.setAttribute("content", data.og_description);
						document
							.getElementById("og-image")
							.setAttribute("content", data.og_image);

						// Update Twitter tags
						document
							.getElementById("twitter-title")
							.setAttribute("content", data.twitter_title);
						document
							.getElementById("twitter-description")
							.setAttribute("content", data.twitter_description);
						document
							.getElementById("twitter-image")
							.setAttribute("content", data.twitter_image);

						// Update canonical URL
						document
							.getElementById("canonical-url")
							.setAttribute("href", data.canonical_url);

						// Update structured data
						document.getElementById("structured-data").textContent =
							JSON.stringify(data.structured_data);

						// Redirect to actual shop page after a short delay
						setTimeout(() => {
							window.location.replace(`/shop/${shopSlug}`);
						}, 2000);
					})
					.catch((error) => {
						console.error("Error fetching meta tags:", error);
						// Redirect to homepage on error
						window.location.replace("/");
					});
			} else {
				// Fallback to homepage
				window.location.replace("/");
			}
		</script>

		<!-- Fallback redirect for non-JS users -->
		<noscript>
			<meta http-equiv="refresh" content="0; url=/" />
		</noscript>

		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
					sans-serif;
				margin: 0;
				padding: 20px;
				background-color: #f5f5f5;
				text-align: center;
			}
			.loading {
				max-width: 600px;
				margin: 50px auto;
				padding: 40px;
				background: white;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			.spinner {
				width: 40px;
				height: 40px;
				border: 4px solid #f3f3f3;
				border-top: 4px solid #ffd700;
				border-radius: 50%;
				animation: spin 1s linear infinite;
				margin: 0 auto 20px;
			}
			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
			h1 {
				color: #333;
				margin-bottom: 10px;
			}
			p {
				color: #666;
				margin-bottom: 20px;
			}
			.redirect-notice {
				background: #e8f4fd;
				border: 1px solid #bee5eb;
				border-radius: 4px;
				padding: 15px;
				margin-top: 20px;
				color: #0c5460;
			}
		</style>
	</head>
	<body>
		<div class="loading">
			<div class="spinner"></div>
			<h1>Loading Shop Information...</h1>
			<p>Please wait while we prepare the shop page for you.</p>
			<div class="redirect-notice">
				<strong>Redirecting...</strong> You will be automatically redirected to
				the shop page in a moment.
			</div>
		</div>
	</body>
</html>
